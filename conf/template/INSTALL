## REMOVE THIS LINE WHEN YOU HAVE EDITED THIS FILE ####################
## $Id$
#!/bin/bash
PROD=gawk
VERSION=3.1
PACKAGER=mo

. `dirname $0`/INSTALL.lib

## set the compiler and PATH
if [ -e /etc/debian_version -o $OS = Darwin ]; then 
   # we use the OS included GCC compiler
   if [ -e /usr/bin/gfortran ]; then
      export F77=gfortran
   else
      export F77=g77
   fi
   export CC=gcc CXX=g++
   export PATH=/usr/bin:${PATH}
else
   OSREL=`/bin/uname -r`
   if [ $OSREL = "5.10" ]; then
   	   # use sfw gcc on solaris 10
	   export CC=gcc CXX=g++ F77=g77
	   export PATH=/usr/bin:/usr/sfw/bin:/usr/ccs/bin:${PATH}
   else
	   # there is no native gcc compiler 
	   v=4.3.3
	   export CC=gcc-$v CXX=g++-$v F77=g77-$v
	   path_gcc=`$CC --seppdebug 2>&1 | grep Path: | awk '{print $2}'`
	   export PATH=`dirname $path_gcc`:${PATH}
   fi
fi

# only link the needed libs (-Wl,--as-needed on platforms that support it)
[ -n "$LDFLAG_AS_NEEDED" ] && export LDFLAGS=$LDFLAG_AS_NEEDED

## you can supply a patch ... relative to the unpacked archives root directory
## use gdiff -u to build the patch
echo ---------------------------------
echo Compilers $CC $CXX $F77
echo --------------------------------- 

## patch is applied to the unpacked source when simplebuild()
## or prepare() is called

cat <<'PATCH' >$WORKDIR/patch
--- one.orig    Fri Mar 19 12:49:05 2004
+++ one Fri Mar 19 12:48:56 2004
@@ -1 +1 @@
-Hellop
+Hello
PATCH

# for debian patches *.diff.gz
debpatch http://security.ubuntu.com/ubuntu/pool/main/z/zip zip_2.30-6ubuntu0.1.diff.gz

# for debian change *.tar.gz
debchanges http://archive.ubuntu.com/ubuntu/pool/universe/q/qhull qhull_2009.1-3ubuntu1.debian.tar.gz

# clean patch environment (removes $WORKDIR/patch, $WORKDIR/deb-patch, $WORKDIR/debchanges.tar)
cleanpatches

## build software from source, using configure, make and make install
simplebuild  http://ftp.gnu.org/gnu/${PROD} ${PROD}-${VERSION}.tar.gz \
    --with-fun-option \
    --disable-gugus

## build a perl module using module source URL
perlmodule http://www.cpan.org/modules/by-module/DBD/ DBD-Pg-1.22.tar.gz

## convenient way to build a perl module, using only the module name
perlmodule Time::HiRes

## build a python module using module source URL
pythonmodule http://jamwt.com/downloads/apricot apricot-0.2.tar.gz 

## just fetch and  unpack
if prepare http://ftp.gnu.org/gnu/${PROD} ${PROD}-${VERSION}.tar.gz
then
  # do something, starting in the unpacked softwares root dir
   ./configure --prefix=${PREFIX} --exec-prefix=${EPREFIX} --with-my-option
   make
   make install
fi
